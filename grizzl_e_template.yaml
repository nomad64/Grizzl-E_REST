# Grizzl-E Template Entities
# These template entities provide a more user-friendly interface for controlling the charger.

- switch:
    # Switch to enable/disable OCPP integration
    - name: grizzl_e_ocpp
      unique_id: grizzl_e_ocpp
      state: "{{ is_state('binary_sensor.grizzl_e_ocpp_enabled', 'on') }}"
      turn_on:
        - action: rest_command.grizzl_e_ocpp_enable
      turn_off:
        - action: rest_command.grizzl_e_ocpp_disable

    # Switch to enable/disable charging (EVSE)
    - name: grizzl_e_charge
      unique_id: grizzl_e_charge
      # Note: evse_enabled=0 means charging is enabled in the API, so we map 'off' to 'on'
      state: "{{ is_state('binary_sensor.grizzl_e_evse_enabled', 'off') }}"
      turn_on:
        - action: rest_command.grizzl_e_charge_enable
      turn_off:
        - action: rest_command.grizzl_e_charge_disable

- number:
    # Number entity to set the charging current
    - name: grizzl_e_charge_current
      unique_id: grizzl_e_charge_current
      # Read the current setting from the charger sensor
      state: "{{ states('sensor.grizzl_e_current_set') | int(0) }}"
      min: 6
      max: 48
      step: 1
      unit_of_measurement: "A"
      icon: mdi:ampersand
      # When changed in the UI, call the rest_command
      set_value:
        - action: rest_command.grizzl_e_set_charge_rate
          data:
            current: "{{ value | int }}"
